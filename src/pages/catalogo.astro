---
import Layout from "../components/Layout.astro";
import BoutiqueCard from "../components/BoutiqueCard.astro";
import catalogData from "../data/catalog.json";

// Agrupar por categoría si es necesario, por ahora plano
const products = catalogData.flowers;
---

<Layout title="Catálogo Completo | Tapti">
  <div class="min-h-screen pt-24 pb-12 px-4">
    <BoutiqueCard
      variant="services"
      size="large"
      className="!h-auto min-h-[70vh] p-8 max-w-7xl mx-auto"
    >
      <h1 class="font-serif text-4xl text-honey-bronze-400 mb-8 text-center">
        Catálogo de Flores
      </h1>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          products.map((product) => (
            <div class="bg-white/5 p-6 rounded-lg border border-white/10 hover:border-honey-bronze-400/50 transition-colors">
              <h2 class="font-serif text-2xl text-honey-bronze-100 mb-4">
                {product.name}
              </h2>
              {product.image?.map((image) => (
                <img src={image} alt={product.name} />
              ))}
              <div class="space-y-4">
                <div class="flex justify-between text-sm text-cherry-blossom-100 border-b border-white/10 pb-2">
                  <span>Tamaño</span>
                  <span>Varas</span>
                  <span>Precio</span>
                </div>
                {Object.entries(product.sizes).map(([size, details]) => {
                  if (!details) return null;
                  return (
                    <div class="flex justify-between items-center text-gray-300">
                      <span class="font-medium text-honey-bronze-400">
                        {size}
                      </span>
                      <span>{details.qty}</span>
                      <div class="flex items-center gap-3">
                        <span class="font-bold">
                          ${details.total.toLocaleString("es-CL")}
                        </span>
                        <button
                          class="add-to-cart-btn bg-honey-bronze-500 hover:bg-honey-bronze-400 text-midnight-violet-950 rounded-full p-1 transition-colors"
                          data-product={JSON.stringify(product)}
                          data-size={size}
                          data-price={details.total}
                          title="Agregar al carrito"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          >
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>

              <div class="mt-6 pt-4 border-t border-white/10">
                <p class="text-xs text-gray-400 mb-2">Composición:</p>
                <div class="h-20 bg-black/20 rounded p-2 text-sm text-gray-500 italic">
                  {/* Espacio para las flores como pidió el usuario */}
                  {product.name} y follaje de estación...
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </BoutiqueCard>
  </div>
</Layout>

<script>
  import { addCartItem } from "../store/cartStore";

  const buttons = document.querySelectorAll(".add-to-cart-btn");

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const productStr = btn.getAttribute("data-product");
      const size = btn.getAttribute("data-size");
      const priceStr = btn.getAttribute("data-price");

      if (productStr && size && priceStr) {
        const product = JSON.parse(productStr);
        const price = parseInt(priceStr);
        addCartItem(product, size, price);
      }

      // Visual feedback
      const originalContent = btn.innerHTML;
      btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
      btn.classList.add("bg-green-500", "text-white");
      btn.classList.remove("bg-honey-bronze-500", "text-midnight-violet-950");

      setTimeout(() => {
        btn.innerHTML = originalContent;
        btn.classList.remove("bg-green-500", "text-white");
        btn.classList.add("bg-honey-bronze-500", "text-midnight-violet-950");
      }, 1000);
    });
  });
</script>
