import"./hoisted.BYdrvtP8.js";const c=document.querySelector("#subscription-form"),e=document.querySelector("#address"),d=c?.querySelector('button[type="submit"]');let i=!1;async function u(){const r=e.value;if(!(r.length<5)){e.classList.contains("border-red-500"),e.classList.remove("border-red-500","border-green-500","border-purple-300/30"),e.classList.add("border-yellow-400");try{const l=await(await fetch("/api/validate-address",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:r})})).json();e.classList.remove("border-yellow-400"),l.isValid?(e.classList.add("border-green-500"),i=!0):(e.classList.add("border-red-500"),i=!1,alert("Dirección no encontrada. Por favor verifica."))}catch(o){console.error(o),e.classList.remove("border-yellow-400"),e.classList.add("border-purple-300/30")}}}e&&e.addEventListener("blur",u);c&&c.addEventListener("submit",async r=>{if(r.preventDefault(),!i&&(await u(),!i))return;const o=new FormData(r.target),l=Object.fromEntries(o);d.textContent="Procesando...",d.disabled=!0;try{const s=await fetch("/api/orders/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(s.ok){const n=await s.json();if(n.url&&n.token){const t=document.createElement("form");t.action=n.url,t.method="POST";const a=document.createElement("input");a.type="hidden",a.name="token_ws",a.value=n.token,t.appendChild(a),document.body.appendChild(t),t.submit()}else alert("Error: No se recibió URL de pago")}else alert("Error al crear la orden. Intente nuevamente.")}catch(s){console.error("Error:",s),alert("Ocurrió un error inesperado")}finally{d.innerHTML=`<span>Ir al Pago</span>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
      </svg>`,d.disabled=!1}});
