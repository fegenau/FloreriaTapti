import{c as v,a as b,r as E}from"./cartStore.CxgG6EVp.js";const p=document.getElementById("cart-empty"),g=document.getElementById("cart-content"),m=document.getElementById("cart-items-container"),h=document.getElementById("cart-total"),x=document.getElementById("btn-cancel"),c=document.getElementById("form-checkout");let f=[];function L(s){const n=Object.values(s);if(f=n,n.length===0){p?.classList.remove("hidden"),g?.classList.add("hidden");return}if(p?.classList.add("hidden"),g?.classList.remove("hidden"),m){m.innerHTML="";let d=0;n.forEach(e=>{const o=e.price*e.quantity;d+=o;const t=document.createElement("div");t.className="flex items-center gap-4 bg-white/5 p-4 rounded-lg border border-white/5",t.innerHTML=`
            <div class="w-20 h-20 bg-black/20 rounded overflow-hidden flex-shrink-0">
              ${e.image?`<img src="${e.image}" alt="${e.name}" class="w-full h-full object-cover" />`:'<div class="w-full h-full flex items-center justify-center text-2xl">ðŸŒ¸</div>'}
            </div>
            <div class="flex-grow">
              <h3 class="font-serif text-lg text-honey-bronze-100">${e.name}</h3>
              <p class="text-sm text-gray-400">TamaÃ±o: ${e.size}</p>
              <p class="text-sm text-cherry-blossom-100">Cantidad: ${e.quantity}</p>
            </div>
            <div class="text-right">
              <p class="font-bold text-honey-bronze-400">$${o.toLocaleString("es-CL")}</p>
              <button class="text-xs text-red-400 hover:text-red-300 mt-1 underline btn-remove" data-id="${e.id}">
                Eliminar
              </button>
            </div>
          `,m.appendChild(t)}),h&&(h.innerText=`$${d.toLocaleString("es-CL")}`),document.querySelectorAll(".btn-remove").forEach(e=>{e.addEventListener("click",o=>{const t=o.target.getAttribute("data-id");t&&E(t)})})}}v.subscribe(L);x?.addEventListener("click",()=>{confirm("Â¿EstÃ¡s seguro de que quieres vaciar tu carrito?")&&b()});const u=c.querySelector('input[name="address"]');u&&typeof google<"u"&&(new google.maps.places.Autocomplete(u,{componentRestrictions:{country:"cl"},fields:["address_components","geometry","name"],types:["address"]}),u.addEventListener("keydown",s=>{s.key==="Enter"&&s.preventDefault()}));let y=!1;const l=document.getElementById("accessories-modal");document.addEventListener("accessories-complete",()=>{y=!0,c.requestSubmit()});c?.addEventListener("submit",async s=>{if(s.preventDefault(),f.length===0)return alert("El carrito estÃ¡ vacÃ­o");if(!y){l&&(l.classList.remove("opacity-0","pointer-events-none"),l.querySelector("div")?.classList.remove("scale-95"),l.querySelector("div")?.classList.add("scale-100"));return}const n=new FormData(c),d={name:n.get("name"),rut:n.get("rut"),email:n.get("email"),phone:n.get("phone"),commune:n.get("commune"),address:n.get("address"),items:f},e=c.querySelector('button[type="submit"]'),o=e.innerText;e.innerText="Procesando...",e.disabled=!0;try{const t=await fetch("/api/orders/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),r=await t.json();if(!t.ok)throw new Error(r.error||"Error desconocido");if(r.url&&r.token){const a=document.createElement("form");a.action=r.url,a.method="POST";const i=document.createElement("input");i.type="hidden",i.name="token_ws",i.value=r.token,a.appendChild(i),document.body.appendChild(a),a.submit()}}catch(t){alert("Error: "+t.message),e.innerText=o,e.disabled=!1}});
