---
import Layout from "../components/Layout.astro";
import BoutiqueCard from "../components/BoutiqueCard.astro";
import SubscriptionForm from "../components/SubscriptionForm.astro";
---

<Layout title="Membresías — Tapti">
  <div class="max-w-6xl mx-auto px-4 py-12">
    <BoutiqueCard
      variant="services"
      size="large"
      className="!h-auto min-h-[70vh] p-8"
    >
      <h1 class="font-serif text-3xl mb-2 text-honey-bronze-100">
        Membresías Tapti
      </h1>
      <p class="text-white/80 mb-8">
        Recibe un ramo Tapti cada 15 o 30 días. Cancela cuando quieras.
      </p>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="p-6 rounded-2xl border border-white/10 bg-white/5">
          <h2 class="font-serif text-2xl text-honey-bronze-100">Quincenal</h2>
          <p class="text-sm opacity-90 text-gray-300">Entrega cada 15 días</p>
          <div class="text-3xl font-serif mt-4 text-white">$20.000 CLP</div>
          <button
            class="open-subscription-btn mt-6 px-6 py-3 rounded-full bg-honey-bronze-500 hover:bg-honey-bronze-400 text-midnight-violet-950 font-bold transition-transform hover:scale-105"
            data-duration="15">Suscribirme</button
          >
        </div>
        <div class="p-6 rounded-2xl border border-white/10 bg-white/5">
          <h2 class="font-serif text-2xl text-honey-bronze-100">Mensual</h2>
          <p class="text-sm opacity-90 text-gray-300">Entrega cada 30 días</p>
          <div class="text-3xl font-serif mt-4 text-white">$15.000 CLP</div>
          <button
            class="open-subscription-btn mt-6 px-6 py-3 rounded-full bg-honey-bronze-500 hover:bg-honey-bronze-400 text-midnight-violet-950 font-bold transition-transform hover:scale-105"
            data-duration="30">Suscribirme</button
          >
        </div>
      </div>
    </BoutiqueCard>

    {/* Subscription Modal */}
    <div
      id="subscription-modal"
      class="fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4"
    >
      <div class="relative w-full max-w-lg">
        <button
          id="close-subscription-modal"
          class="absolute -top-4 -right-4 z-50 bg-white text-black rounded-full p-2 shadow-lg hover:bg-gray-200 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            ><line x1="18" y1="6" x2="6" y2="18"></line><line
              x1="6"
              y1="6"
              x2="18"
              y2="18"></line></svg
          >
        </button>
        <SubscriptionForm />
      </div>
    </div>
  </div>

  <script>
    const subModal = document.getElementById("subscription-modal");
    const closeSubBtn = document.getElementById("close-subscription-modal");
    const openBtns = document.querySelectorAll(".open-subscription-btn");

    // Open Modal
    openBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        if (!subModal) return;

        // Optional: Pre-select duration if possible
        const duration = btn.getAttribute("data-duration");
        const select = document.querySelector("#duration") as HTMLSelectElement;
        if (select && duration) {
          select.value = duration;
        }

        subModal.classList.remove("hidden");
        subModal.classList.add("flex");
        document.body.style.overflow = "hidden";
      });
    });

    // Close Logic
    if (closeSubBtn && subModal) {
      closeSubBtn.addEventListener("click", () => {
        subModal.classList.add("hidden");
        subModal.classList.remove("flex");
        document.body.style.overflow = "";
      });
    }

    if (subModal) {
      subModal.addEventListener("click", (e) => {
        if (e.target === subModal) {
          subModal.classList.add("hidden");
          subModal.classList.remove("flex");
          document.body.style.overflow = "";
        }
      });
    }
  </script>
</Layout>
