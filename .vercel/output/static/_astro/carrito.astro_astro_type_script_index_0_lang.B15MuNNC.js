import{c as x,a as L,r as w}from"./cartStore.CxgG6EVp.js";document.addEventListener("astro:page-load",()=>{const g=document.getElementById("cart-empty"),p=document.getElementById("cart-content"),m=document.getElementById("cart-items-container"),h=document.getElementById("cart-total"),E=document.getElementById("btn-cancel"),i=document.getElementById("form-checkout");let u=[];function b(s){const r=Object.values(s);if(u=r,r.length===0){g?.classList.remove("hidden"),p?.classList.add("hidden");return}if(g?.classList.add("hidden"),p?.classList.remove("hidden"),m){m.innerHTML="";let a=0;r.forEach(e=>{const c=e.price*e.quantity;a+=c;const t=document.createElement("div");t.className="flex items-center gap-4 bg-white/5 p-4 rounded-lg border border-white/5",t.innerHTML=`
              <div class="w-20 h-20 bg-black/20 rounded overflow-hidden flex-shrink-0">
                ${e.image?`<img src="${e.image}" alt="${e.name}" class="w-full h-full object-cover" />`:'<div class="w-full h-full flex items-center justify-center text-2xl">ðŸŒ¸</div>'}
              </div>
              <div class="flex-grow">
                <h3 class="font-serif text-lg text-honey-bronze-100">${e.name}</h3>
                <p class="text-sm text-gray-400">TamaÃ±o: ${e.size}</p>
                <p class="text-sm text-cherry-blossom-100">Cantidad: ${e.quantity}</p>
              </div>
              <div class="text-right">
                <p class="font-bold text-honey-bronze-400">$${c.toLocaleString("es-CL")}</p>
                <button class="text-xs text-red-400 hover:text-red-300 mt-1 underline btn-remove" data-id="${e.id}">
                  Eliminar
                </button>
              </div>
            `,m.appendChild(t)}),h&&(h.innerText=`$${a.toLocaleString("es-CL")}`),document.querySelectorAll(".btn-remove").forEach(e=>{e.addEventListener("click",c=>{const t=c.target.getAttribute("data-id");t&&w(t)})})}}if(x.subscribe(b),E?.addEventListener("click",()=>{confirm("Â¿EstÃ¡s seguro de que quieres vaciar tu carrito?")&&L()}),i){const s=i.querySelector('input[name="address"]');s&&typeof google<"u"&&(new google.maps.places.Autocomplete(s,{componentRestrictions:{country:"cl"},fields:["address_components","geometry","name"],types:["address"]}),s.addEventListener("keydown",r=>{r.key==="Enter"&&r.preventDefault()}))}let v=!1;const l=document.getElementById("accessories-modal");document.addEventListener("accessories-complete",()=>{v=!0,i?.requestSubmit()});const y=document.getElementById("input-rut");y&&y.addEventListener("input",s=>{const r=s.target;let a=r.value.replace(/[^0-9kK]/g,"");if(a.length>1){const e=a.slice(0,-1),c=a.slice(-1);let t="";for(let n=e.length-1,o=0;n>=0;n--,o++)t=e.charAt(n)+(o>0&&o%3===0?".":"")+t;r.value=`${t}-${c}`}else r.value=a}),i?.addEventListener("submit",async s=>{if(s.preventDefault(),document.querySelectorAll(".error-msg").forEach(t=>{t.classList.add("hidden"),t.textContent=""}),u.length===0)return alert("El carrito estÃ¡ vacÃ­o");if(!v){l&&(l.classList.remove("opacity-0","pointer-events-none"),l.querySelector("div")?.classList.remove("scale-95"),l.querySelector("div")?.classList.add("scale-100"));return}const r=new FormData(i),a={name:r.get("name"),rut:r.get("rut"),email:r.get("email"),phone:r.get("phone"),commune:r.get("commune"),address:r.get("address"),items:u},e=i.querySelector('button[type="submit"]'),c=e.innerText;e.innerText="Procesando...",e.disabled=!0;try{const t=await fetch("/api/orders/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await t.json();if(!t.ok)throw n.fieldErrors?(Object.entries(n.fieldErrors).forEach(([o,d])=>{const f=document.getElementById(`error-${o}`);f&&(f.textContent=d,f.classList.remove("hidden"))}),new Error("Por favor corrige los errores en el formulario.")):new Error(n.error||"Error desconocido");if(n.url&&n.token){const o=document.createElement("form");o.action=n.url,o.method="POST";const d=document.createElement("input");d.type="hidden",d.name="token_ws",d.value=n.token,o.appendChild(d),document.body.appendChild(o),o.submit()}}catch(t){t.message.includes("corrige los errores")||alert("Error: "+t.message),e.innerText=c,e.disabled=!1}})});
