let f=[],u=0;const c=4,p=e=>{let s=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(i){return t.lc=s.push(i),()=>{for(let l=u+c;l<f.length;)f[l]===i?f.splice(l,c):l+=c;let n=s.indexOf(i);~n&&(s.splice(n,1),--t.lc||t.off())}},notify(i,n){let l=!f.length;for(let r of s)f.push(r,t.value,i,n);if(l){for(u=0;u<f.length;u+=c)f[u](f[u+1],f[u+2],f[u+3]);f.length=0}},off(){},set(i){let n=t.value;n!==i&&(t.value=i,t.notify(n))},subscribe(i){let n=t.listen(i);return i(t.value),n},value:e};return t},I=5,v=6,g=10;let y=(e,s,t,i)=>(e.events=e.events||{},e.events[t+g]||(e.events[t+g]=i(n=>{e.events[t].reduceRight((l,r)=>(r(l),l),{shared:{},...n})})),e.events[t]=e.events[t]||[],e.events[t].push(s),()=>{let n=e.events[t],l=n.indexOf(s);n.splice(l,1),n.length||(delete e.events[t],e.events[t+g](),delete e.events[t+g])}),O=1e3,T=(e,s)=>y(e,i=>{let n=s(i);n&&e.events[v].push(n)},I,i=>{let n=e.listen;e.listen=(...r)=>(!e.lc&&!e.active&&(e.active=!0,i()),n(...r));let l=e.off;return e.events[v]=[],e.off=()=>{l(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let r of e.events[v])r();e.events[v]=[]}},O)},()=>{e.listen=n,e.off=l}}),h=e=>e,d={},m={addEventListener(){},removeEventListener(){}};function N(){try{return typeof localStorage<"u"}catch{return!1}}N()&&(d=localStorage);let x={addEventListener(e,s,t){window.addEventListener("storage",s),window.addEventListener("pageshow",t)},removeEventListener(e,s,t){window.removeEventListener("storage",s),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(m=x);function S(e,s=void 0,t={}){let i=t.encode||h,n=t.decode||h,l=p(s),r=l.set;l.set=o=>{let w=i(o);typeof w>"u"?delete d[e]:d[e]=w,r(o)};function L(o){o.key===e?o.newValue===null?r(s):r(n(o.newValue)):d[e]||r(s)}function E(){l.set(d[e]?n(d[e]):s)}return T(l,()=>{if(E(),t.listen!==!1)return m.addEventListener(e,L,E),()=>{m.removeEventListener(e,L,E)}}),l}const a=S("cartItems",{},{encode:JSON.stringify,decode:JSON.parse});function q(e,s,t){const i=a.get(),n=`${e.name}-${s}`.replace(/\s+/g,"-").toLowerCase(),l=i[n];l?a.set({...i,[n]:{...l,quantity:l.quantity+1}}):a.set({...i,[n]:{id:n,name:e.name,size:s,price:t,quantity:1,image:e.image?e.image[0]:null}})}function U(e){const s=a.get(),{[e]:t,...i}=s;a.set(i)}function _(e){const s=a.get(),t=s[e];t&&(t.quantity>1?a.set({...s,[e]:{...t,quantity:t.quantity-1}}):U(e))}function M(){a.set({})}export{M as a,q as b,a as c,_ as d,U as r};
